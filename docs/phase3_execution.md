## é˜¶æ®µä¸‰æ‰§è¡Œè®¡åˆ’ï¼ˆæŒä¹…åŒ–ä¸å›æ”¾ï¼‰â€”â€”æ‰‹å±€å¼€å§‹å¿«ç…§ + å•ä¼šè¯è¿½åŠ æ—¥å¿— + ç§æœ‰æ—¥å¿—å¯é€‰ + æ˜ç¡®æ¢å¤åè®®ï¼ˆKISS / YAGNIï¼Œå•æ–‡ä»¶ <200 è¡Œï¼‰

æœ¬æ–¹æ¡ˆåœ¨ç°æœ‰é˜¶æ®µä¸€/äºŒçš„â€œå…¨é‡ TABLE_STATE å¹¿æ’­ + äº‹ä»¶æç¤º + ä¼šè¯/ç”Ÿå‘½å‘¨æœŸâ€åŸºç¡€ä¸Šï¼Œå¢é‡å®ç°æŒä¹…åŒ–ä¸å›æ”¾ï¼Œé¿å…é‡æ„åˆ°å®Œæ•´äº‹ä»¶æº¯æºã€‚æ ¸å¿ƒç­–ç•¥ï¼šä»¥â€œæ‰‹å±€å¼€å§‹æ—¶çš„å¿«ç…§â€ä¸ºå”¯ä¸€æ£€æŸ¥ç‚¹ï¼Œä»¥â€œä¼šè¯çº§å•ä¸€è¿½åŠ æ—¥å¿—â€ä¸ºå”¯ä¸€æ•°æ®æºï¼ˆå…¬å…±ï¼‰ï¼Œç§æœ‰æ—¥å¿—å¯é€‰å¼€å¯ä»¥å®ç°100%ä¿çœŸå›æ”¾ã€‚

### 1. ç›®æ ‡ä¸éªŒæ”¶

- ç›®æ ‡
  - æŒä¹…åŒ–ï¼šåœ¨æ¯æ‰‹å¼€å§‹æ—¶åˆ›å»ºå¿«ç…§ï¼›åŠ¨ä½œä¸äº‹ä»¶ä»¥ä¼šè¯çº§å•ä¸€ `events.ndjson` è¿½åŠ æ—¥å¿—è®°å½•ï¼ˆå…¬å…±ï¼‰ï¼›å¯é€‰ `private.ndjson` å­˜å‚¨ç§æœ‰å‘ç‰Œäº‹ä»¶ã€‚
  - å›æ”¾ï¼šåŠ è½½å¿«ç…§å¹¶é¡ºåºé‡æ”¾è¯¥æ‰‹çš„äº‹ä»¶æµï¼Œæ¢å¤å…¬å…±çŠ¶æ€ä¸ç»“ç®—ï¼›åœ¨ç®¡ç†å‘˜æ¨¡å¼ä¸‹å¯è¯»å–ç§æœ‰æ—¥å¿—å®ç°é€ç‰Œ100%ä¿çœŸã€‚
  - æ¢å¤ï¼šæœåŠ¡å´©æºƒæˆ–é‡å¯æ—¶ï¼Œå›æ»šåˆ°ä¸Šä¸€ä¸ªå®Œæˆæ‰‹å±€ä¹‹åçš„â€œç­‰å¾…çŠ¶æ€â€ï¼Œä¿è¯ä¸€è‡´æ€§ã€‚
- éªŒæ”¶
  - ç«¯åˆ°ç«¯è·‘é€šï¼šè‹¥å¹²æ‰‹â†’ç»“æŸæ•´å±€â†’è½åœ°ä¼šè¯ç›®å½•â†’å…¬å…±å›æ”¾ä¸€è‡´ï¼›ç®¡ç†å‘˜æ¨¡å¼ä¸‹é€ç‰Œä¸€è‡´ã€‚
  - é‡å¯æ¢å¤ï¼šæ€»èƒ½æ¢å¤åˆ°ä¸Šä¸€ä¸ªå®Œæˆæ‰‹å±€åçš„ `WAITING`ï¼›ä¸ä¼šå¡åœ¨ä¸­é—´æ€ã€‚
  - ä¿æŒâ€œå…¨é‡ TABLE_STATE å¹¿æ’­â€ç­–ç•¥ä¸å˜ï¼›æ–°å¢ä»…ä¸ºæŒä¹…åŒ–/å›æ”¾å†…éƒ¨å®ç°ã€‚

### 2. èŒƒå›´ä¸éç›®æ ‡

- èŒƒå›´
  - æ–‡ä»¶å‹æŒä¹…åŒ–ï¼ˆJSON/NDJSON è‡³ `data/`ï¼‰ï¼›
  - å¿«ç…§/äº‹ä»¶è®°å½•å™¨ä¸æœ€å°å›æ”¾å¼•æ“ï¼›
  - å¯åŠ¨æ—¶æ¢å¤ï¼›æœ€å°åªè¯» Admin ç«¯ç‚¹/CLIã€‚
- éç›®æ ‡ï¼ˆå»¶åï¼‰
  - å®Œæ•´äº‹ä»¶æº¯æºé‡æ„ä¸ç”Ÿäº§æ•°æ®åº“ï¼ˆRedis/Mongoï¼‰ï¼›
  - å®Œæ•´ UI æ’­æ”¾å™¨ï¼ˆæœ¬é˜¶æ®µä»…æ–‡æœ¬æˆ–æœ€å° UI æ”¯æŒï¼‰ã€‚

### 3. æ¶æ„æ€»è§ˆ

- å¿«ç…§ï¼šä»…åœ¨â€œæ‰‹å±€å¼€å§‹åâ€ä¿å­˜ä¼šè¯å¿«ç…§ï¼ˆè¦†ç›–å†™ï¼‰ï¼Œä½œä¸ºæ£€æŸ¥ç‚¹/åŠ é€Ÿå™¨ã€‚
- äº‹ä»¶ï¼šä¼šè¯çº§ `events.ndjson` è¿½åŠ æ‰€æœ‰å…¬å…±åŠ¨ä½œ/äº‹ä»¶ï¼ˆå•ä¸€æ•°æ®æºï¼‰ã€‚
- ç§æœ‰äº‹ä»¶ï¼ˆå¯é€‰ï¼‰ï¼š`private.ndjson` è®°å½• `DECK_SHUFFLED`ã€`HOLE_CARDS_DEALT` ç­‰ï¼Œä»…ç®¡ç†å‘˜å¯è¯»ã€‚
- æ¢å¤ï¼šå¯åŠ¨â†’åŠ è½½æœ€è¿‘å¿«ç…§â†’ä»æ—¥å¿—é‡æ”¾â†’ä¸¢å¼ƒæœªå®Œæˆå°¾éƒ¨â†’è¿›å…¥ `WAITING`ã€‚

### 4. æ•°æ®ä¸æ–‡ä»¶å¸ƒå±€ï¼ˆä¼šè¯çº§å•æ—¥å¿—ï¼‰

- ç›®å½•ç»“æ„
```
data/sessions/{sessionId}/
  â”œâ”€ session.json        # ä¼šè¯å…ƒä¿¡æ¯ + æœ€æ–°å¿«ç…§ï¼ˆè¦†ç›–å†™ï¼‰
  â”œâ”€ events.ndjson       # å…¬å…±äº‹ä»¶/åŠ¨ä½œï¼ŒæŒç»­è¿½åŠ ï¼ˆå•ä¸€æ•°æ®æºï¼‰
  â”œâ”€ private.ndjson      # å¯é€‰ï¼šç§æœ‰äº‹ä»¶ï¼ˆå®Œæ•´å‘ç‰Œå‰§æœ¬ï¼‰ï¼Œé»˜è®¤å…³é—­
  â””â”€ events.idx          # å¯é€‰ï¼šç´¢å¼•ï¼ˆhandNumber â†’ æ–‡ä»¶åç§»ï¼‰æå‡å›æ”¾/æ¢å¤é€Ÿåº¦
```
- `session.json`ï¼ˆå¿«ç…§ï¼‰
```json
{
  "meta": { "version": 1, "savedAt": 1730000000000 },
  "session": { "id": "session_xxx", "startedAt": 1729990000000, "handsPlayed": 13 },
  "gameState": { /* GameStateSerializer.serialize() è¾“å‡ºï¼ˆè§ Â§6ï¼‰ */ }
}
```
- `events.ndjson`ï¼ˆæ¯è¡Œä¸€äº‹ä»¶ï¼‰
```json
{"seq":1,"t":1730000000100,"sessionId":"session_xxx","handNumber":14,"type":"HAND_STARTED","payload":{}}
{"seq":2,"t":1730000000200,"sessionId":"session_xxx","handNumber":14,"type":"PLAYER_ACTION","payload":{"playerId":"p1","action":"bet","amount":100}}
{"seq":3,"t":1730000000300,"sessionId":"session_xxx","handNumber":14,"type":"FLOP_DEALT","payload":{"cards":["Ah","Kd","7s"]}}
{"seq":9,"t":1730000000900,"sessionId":"session_xxx","handNumber":14,"type":"HAND_FINISHED","payload":{"pots":[...],"winners":["p1"]}}
```
- `private.ndjson`ï¼ˆå¯é€‰ï¼‰
```json
{"seq":1,"t":1730000000050,"type":"DECK_SHUFFLED","payload":{"orderedDeck":["As","Kh","..."]}}
{"seq":2,"t":1730000000150,"type":"HOLE_CARDS_DEALT","payload":{"playerId":"p1","cards":["Ah","Kd"]}}
```

### 5. äº‹ä»¶æ¨¡å‹ï¼ˆæœ€å°å¿…è¦é›†ï¼‰

- åŠ¨ä½œç±»ï¼š`PLAYER_ACTION { playerId, action, amount? }`
- æµç¨‹ç±»ï¼š`HAND_STARTED`ã€`ROUND_CLOSED`ã€`STREET_ADVANCED`ã€`FLOP_DEALT`ã€`TURN_DEALT`ã€`RIVER_DEALT`ã€`SHOWDOWN_STARTED`ã€`POTS_DISTRIBUTED`ã€`HAND_FINISHED`ã€`GAME_ENDED`
- å­—æ®µè§„èŒƒ
  - å…¬å…±äº‹ä»¶æ ¼å¼ï¼š`{ seq, t, sessionId, handNumber, type, payload }`
  - ç§æœ‰äº‹ä»¶æ ¼å¼ï¼š`{ seq, t, type, payload }`ï¼ˆä¸æš´éœ² sessionId/handNumber ç»™å…¬å…± APIï¼‰

### 6. å¿«ç…§ç­–ç•¥ï¼ˆå•ä¸€æ£€æŸ¥ç‚¹ï¼‰

- æ—¶æœºï¼šä»…åœ¨â€œæ‰‹å±€å¼€å§‹åâ€ï¼ˆ`HAND_STARTED` å†™å…¥ events åï¼‰ä¿å­˜ä¼šè¯å¿«ç…§ã€‚
- å†…å®¹ï¼š`meta` + `session` æ‘˜è¦ + `gameState`ã€‚
- GameState åºåˆ—åŒ–è¦æ±‚ï¼ˆè¡¥é½/å‰”é™¤ï¼‰ï¼š
  - åŒ…å«ï¼š`gameId, street, phase, tableStatus, players[*]{id,name,chips,position,status,currentBet,totalBet,isDealer,isSmallBlind,isBigBlind,hasCards}, communityCards, pots, totalPot, currentTurn, amountToCall, buttonIndex, handNumber, isActionReopened, activePlayersCount, lastAggressorId, actionHistory, lastShowdownSummary, session{id,startedAt,handsPlayed}`
  - å‰”é™¤ï¼š`players[*].holeCards`ï¼ˆæœªæ­ç¤ºåº•ç‰Œï¼‰ï¼›ä»»ä½•ä¸´æ—¶å¯¹è±¡å¼•ç”¨ã€‚
- ä¸å†åœ¨å¿«ç…§ä¸­å­˜å‚¨ `lastHandResult`ï¼›ç»“æœä»äº‹ä»¶æµæ¨å¯¼ï¼Œä¿è¯â€œå•ä¸€æ•°æ®æºâ€ã€‚

### 7. æ¢å¤åè®®ï¼ˆç¡®å®šæ€§ï¼‰

- å¯åŠ¨æ—¶ï¼š
  - å®šä½æœ€è¿‘ä¼šè¯ç›®å½• `data/sessions/{sessionId}/`
  - è¯»å– `session.json` â†’ åŠ è½½å¿«ç…§ï¼ˆæ‰‹å±€å¼€å§‹æ€ï¼‰
  - ä» `events.ndjson` æµå¼è¯»å–â€œè‡ªè¯¥æ‰‹å¼€å§‹è‡³æœ€è¿‘ `HAND_FINISHED`â€çš„äº‹ä»¶å¹¶é‡æ”¾
  - å¿½ç•¥/ä¸¢å¼ƒ `HAND_FINISHED` ä¹‹åæœªé—­åˆçš„å°¾æ®µï¼ˆè§†ä¸ºå´©æºƒä¸­æ–­ï¼‰
  - è¿›å…¥ `WAITING`ï¼Œå‡†å¤‡å¼€å§‹ä¸‹ä¸€æ‰‹
- å¯é€‰ä¼˜åŒ–ï¼šä½¿ç”¨ `events.idx` å¿«é€Ÿå®šä½æ‰‹å·åŒºé—´åç§»

### 8. ç»„ä»¶ä¸ä¾èµ–å…³ç³»

- `src/server/persistence/storage/Storage.js`
  - å®šä¹‰å­˜å‚¨æ¥å£ï¼ˆappend/save/read/listï¼‰ï¼Œé›¶å®ç°ä¾èµ–
- `src/server/persistence/storage/FileStorage.js`
  - Node `fs/promises` å®ç°ï¼›`appendEvent` ä½¿ç”¨ O_APPENDï¼›è¦†ç›–å†™å¿«ç…§é‡‡ç”¨â€œä¸´æ—¶æ–‡ä»¶+renameâ€
- `src/server/persistence/EventLogger.js`
  - ä¾èµ– `Storage`ï¼›æä¾› `appendPublicEvent()`ã€å¯é€‰ `rotateIndex()`ï¼›ç”± `server` è°ƒç”¨
- `src/server/persistence/PrivateEventLogger.js`ï¼ˆå¯é€‰ï¼‰
  - ä¾èµ– `Storage`ï¼›åœ¨å¯ç”¨æ—¶è®°å½• `DECK_SHUFFLED`ã€`HOLE_CARDS_DEALT`
- `src/server/persistence/SnapshotManager.js`
  - ä¾èµ– `Storage`ã€`Game` åªè¯» getterï¼›åœ¨ `HAND_STARTED` åä¿å­˜å¿«ç…§
- `src/game/replay/ScriptedDeck.js`
  - å—æ§ç‰Œå †ï¼Œä»…å›æ”¾ç”¨ï¼›å…¬å…±æ¨¡å¼å¯ä¸ä¸¥æ ¼ä½¿ç”¨
- `src/game/replay/ReplayEngine.js`
  - ä¾èµ– `Game`ã€`ScriptedDeck`ã€`Storage`ï¼ˆæˆ–æ–‡ä»¶ï¼‰ï¼›æ”¯æŒå…¬å…±/ç®¡ç†å‘˜ä¸¤ç§å›æ”¾æ¨¡å¼

ä¾èµ–å›¾ï¼ˆæ‘˜è¦ï¼‰ï¼š
- `server/server.js` â†’ { `EventLogger`, `SnapshotManager` } â†’ `Storage`
- `ReplayEngine` â†’ { `Storage` | æ–‡ä»¶ } + `Game` + `ScriptedDeck`

### 9. æœåŠ¡ç«¯é›†æˆç‚¹ï¼ˆæœ€å°ä¾µå…¥ï¼‰

- `handlePlayerAction(payload)`ï¼š
  - å…ˆ `EventLogger.appendPublicEvent({type:'PLAYER_ACTION', ...})`
  - è°ƒç”¨ `game.applyAction()`ï¼›éšåç”± `handleGameEvents()` è®°å½•äº§ç”Ÿçš„æµç¨‹äº‹ä»¶
- `handleGameEvents(events)`ï¼š
  - é€æ¡ `EventLogger.appendPublicEvent(event)`
  - ç¢°åˆ° `HAND_STARTED` åâ†’è§¦å‘ `SnapshotManager.saveSnapshot()`
  - `HAND_FINISHED` ä»…è½äº‹ä»¶ï¼Œä¸ä¿å­˜å¿«ç…§
- `server.startGame()` æˆåŠŸåï¼š
  - ç”Ÿæˆå¹¶å¹¿æ’­/è®°å½• `HAND_STARTED`ï¼ˆä¿æŒ `Game` æ— ä¾µå…¥ï¼‰
- `GAME_ENDED`ï¼šè½äº‹ä»¶ï¼›`session.json` å¯æ›´æ–° `handsPlayed` ä¸å…ƒä¿¡æ¯

### 10. å›æ”¾å¼•æ“ï¼ˆä¸¤ç§ç²¾åº¦ï¼‰

- å…¬å…±æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰ï¼š`session.json` + `events.ndjson`ï¼Œç”¨ `ScriptedDeck` æˆ–å…¬å…±äº‹ä»¶é©±åŠ¨ï¼›æœªæ­ç¤ºåº•ç‰Œä¿æŒä¸å¯è§ï¼›å¯¹é½å…¬å…±ç»“è®ºï¼ˆpotsã€èµ¢å®¶ã€`lastShowdownSummary`ï¼‰
- ç®¡ç†å‘˜æ¨¡å¼ï¼ˆå¯é€‰ï¼‰ï¼šé¢å¤–è¯»å– `private.ndjson`ï¼ˆé”å®šè®¿é—®ï¼‰ï¼Œä»¥ `DECK_SHUFFLED`/`HOLE_CARDS_DEALT` 100%å¤åŸé€ç‰Œé¡ºåº

### 11. å®‰å…¨ä¸éšç§

- ç§æœ‰æ—¥å¿—é»˜è®¤å…³é—­ï¼š`PERSIST_PRIVATE=false`
- ä»»ä½•å…¬å…± API ä¸æš´éœ² `private.ndjson`
- ç®¡ç†è¯»å–ä»…åœ¨æœ¬åœ°æˆ–å—æ§å·¥å…·ï¼›å¯é€‰åŠ å¯†/ç­¾åï¼ˆå»¶åï¼‰

### 12. æµ‹è¯•è®¡åˆ’

- å•å…ƒæµ‹è¯•
  - `FileStorage`ï¼šappend/è¦†ç›–å†™/å¹¶å‘å®‰å…¨ï¼›å¼‚å¸¸å›æ»š
  - `SnapshotManager`ï¼š`HAND_STARTED` è§¦å‘ã€å¿«ç…§ç»“æ„ä¸å‰”é™¤ç­–ç•¥æ­£ç¡®
  - `EventLogger`ï¼šåºå·/æ—¶é—´æˆ³/è¿‡æ»¤ handNumber æ­£ç¡®ï¼›ï¼ˆå¯é€‰ï¼‰ç´¢å¼•ç”Ÿæˆæ­£ç¡®
  - `ReplayEngine`ï¼šå…¬å…±æ¨¡å¼ç»“è®ºä¸€è‡´ï¼›ç®¡ç†å‘˜æ¨¡å¼ç‰Œé¢/é¡ºåºå®Œå…¨ä¸€è‡´
  - `GameStateSerializer`ï¼šé˜¶æ®µäºŒå­—æ®µåºåˆ—åŒ–/ååºåˆ—åŒ–ç¨³å®šï¼Œä¸æ³„éœ²ç§æœ‰ç‰Œ
- é›†æˆæµ‹è¯•
  - æ‰“å¤šæ‰‹â†’ç»“æŸâ†’æ£€æŸ¥ `data/sessions/{sid}` æ–‡ä»¶ä¸æ ¸å¿ƒå­—æ®µ
  - æœåŠ¡é‡å¯â†’æŒ‰æ¢å¤åè®®è¿›å…¥ `WAITING`ï¼›æ‰‹æ•°/ç»“ç®—ä¸€è‡´
  - å›æ”¾æ•´ä¼šè¯â†’é€æ‰‹æ ¡éªŒ pots/èµ¢å®¶/`lastShowdownSummary` ä¸€è‡´

### 13. ä»»åŠ¡æ‹†åˆ†ä¸æ’æœŸï¼ˆ3â€“5 äººæ—¥ï¼‰

1) âœ… å­˜å‚¨ä¸å¸ƒå±€ï¼ˆ0.5â€“0.8dï¼‰ï¼š`Storage`/`FileStorage`ï¼ˆappend+è¦†ç›–ã€ç›®å½•ç»“æ„ï¼‰
2) âœ… äº‹ä»¶ä¸å¿«ç…§æ¥å…¥ï¼ˆ1â€“1.2dï¼‰ï¼š`EventLogger`ã€`SnapshotManager`ï¼›`HAND_STARTED` æ—¶æœºæŒ‚é’©
3) âœ… ç§æœ‰æ—¥å¿—ï¼ˆå¯é€‰ï¼Œ0.4â€“0.6dï¼‰ï¼š`PrivateEventLogger`ã€é…ç½®å¼€å…³
4) âœ… å›æ”¾å¼•æ“ï¼ˆ0.8â€“1.2dï¼‰ï¼š`ReplayEngine`ã€`ScriptedDeck`ï¼›åŒæ¨¡å¼å›æ”¾å®Œæˆ
5) ğŸ”„ æœåŠ¡ç«¯é›†æˆï¼ˆ0.3â€“0.5dï¼‰ï¼šserver.jsæŒä¹…åŒ–é’©å­ï¼›å¯åŠ¨æ¢å¤åè®®ï¼›adminç«¯ç‚¹
6) ğŸ“… æœ€ç»ˆéªŒæ”¶ï¼ˆ0.6â€“1dï¼‰ï¼šç«¯åˆ°ç«¯æµ‹è¯•ï¼›æ€§èƒ½éªŒè¯ï¼›æ–‡æ¡£å®Œå–„

**è¿›åº¦æ€»ç»“**: å·²å®Œæˆå‰4ä¸ªä»»åŠ¡ï¼ˆçº¦3.7äººæ—¥ï¼‰ï¼Œå‰©ä½™æœåŠ¡ç«¯é›†æˆå’Œæœ€ç»ˆéªŒæ”¶ã€‚

### 14. é£é™©ä¸ç¼“è§£

- å›æ”¾ä¸ä¸€è‡´ï¼ˆå…¬å…±ä¿¡æ¯ä¸è¶³ï¼‰ï¼šç®¡ç†å‘˜æ¨¡å¼å¯ç”¨ç§æœ‰æ—¥å¿—è·å¾— 100% ä¿çœŸ
- æ–‡ä»¶å¢é•¿ï¼šæŒ‰ä¼šè¯æ»šåŠ¨ï¼›å¯å¢é‡å‹ç¼©å½’æ¡£ï¼ˆå»¶åï¼‰ï¼›å¯é€‰äº‹ä»¶ç´¢å¼•
- å¯åŠ¨æ¢å¤æ€§èƒ½ï¼šå…ˆçº¿æ€§æ‰«æï¼Œå¿…è¦æ—¶å¯ç”¨ `events.idx`
- ä¾µå…¥é£é™©ï¼šæ‰€æœ‰æ¥å…¥ç‚¹é›†ä¸­åœ¨ `server.js` åŠ¨ä½œå…¥å£/äº‹ä»¶å›è°ƒ/æ‰‹å±€å¼€å§‹æ—¶æœºï¼Œ`Game` å†…æ ¸é›¶æ”¹åŠ¨

### 15. æ¥å£ä¸ç«¯ç‚¹è‰æ¡ˆ

- Storage æŠ½è±¡
```ts
interface Storage {
  saveSnapshot(sessionId: string, data: object): Promise<void>; // è¦†ç›–å†™ session.json
  appendPublicEvent(sessionId: string, evt: object): Promise<void>; // è¿½åŠ  events.ndjson
  appendPrivateEvent?(sessionId: string, evt: object): Promise<void>; // å¯é€‰
  listSessions(): Promise<Array<{sessionId:string, startedAt:number, hands:number}>>;
  readSession(sessionId: string): Promise<object>;
  streamPublicEvents(sessionId: string, fromSeq?: number): AsyncIterable<object>;
}
```
- Adminï¼ˆåªè¯»ï¼‰
  - `GET /admin/sessions`ï¼šåˆ—å‡ºç°æœ‰ä¼šè¯ï¼ˆä¸å«ç§æœ‰ï¼‰
  - `GET /admin/sessions/:id/meta`ï¼šè¿”å› `session.json`
  - `GET /admin/sessions/:id/events?fromSeq=`ï¼šæµå¼è¿”å›å…¬å…±äº‹ä»¶
  - å¯é€‰ï¼š`POST /admin/reload/latest`ï¼šå¼€å‘ç¯å¢ƒä»æœ€è¿‘ä¼šè¯æ¢å¤

### 16. é…ç½®å¼€å…³ï¼ˆç¯å¢ƒå˜é‡ï¼‰

- `PERSIST_ENABLED=true`
- `PERSIST_PRIVATE=false`ï¼ˆé»˜è®¤ï¼‰
- `DATA_DIR=./data/sessions`
- `EVENT_INDEX_ENABLED=false`ï¼ˆé»˜è®¤ï¼‰

### 17. 200 è¡Œçº¦æŸä¸ä¸€è‡´æ€§å£°æ˜

- æ–°å¢æ¯ä¸ªæºæ–‡ä»¶ä¸¥æ ¼ <200 è¡Œï¼›å¿…è¦æ—¶ç»§ç»­æ‹†åˆ†å­æ¨¡å—ã€‚
- ä¸æ”¹å˜é˜¶æ®µä¸€/äºŒå¤–éƒ¨è¡Œä¸ºä¸æ¶ˆæ¯ç»“æ„ï¼›ä»…æ–°å¢æŒä¹…åŒ–/å›æ”¾å†…éƒ¨èƒ½åŠ›ã€‚
- ä¿æŒâ€œå…¨é‡ TABLE_STATE å¹¿æ’­ + ç§æœ‰å•æ’­ä¸æ³„éœ²â€ç­–ç•¥ï¼›å…¬å…±å¿«ç…§ä¸å«æœªæ­ç¤ºåº•ç‰Œã€‚

---

- å˜æ›´è¦ç‚¹å›é¡¾
  - å¿«ç…§ä»…åœ¨â€œæ‰‹å±€å¼€å§‹â€ä¿å­˜ï¼›ä»äº‹ä»¶æ¨å¯¼ç»“æœï¼Œç¡®ç«‹å•ä¸€æ•°æ®æºã€‚
  - ä¼šè¯çº§å•ä¸€è¿½åŠ æ—¥å¿—ï¼ˆå…¬å…±ï¼‰ï¼›ç§æœ‰æ—¥å¿—å¯é€‰å¼€å¯å®ç° 100% ä¿çœŸã€‚
  - æ˜ç¡®æ¢å¤åè®®ï¼šåŠ è½½å¿«ç…§â†’é‡æ”¾è‡³æœ€è¿‘ `HAND_FINISHED`â†’ä¸¢å¼ƒå°¾éƒ¨â†’è¿›å…¥ `WAITING`ã€‚
  - æœ€å°ä¾µå…¥æ¥å…¥ `server.js`ï¼›`Game` å†…æ ¸ä¸å˜ï¼›æµ‹è¯•ä¸ç«¯ç‚¹è¦†ç›–ä¸€è‡´æ€§ã€‚

### 18. Gitå·¥ä½œæµä¸æäº¤ç­–ç•¥

#### 18.1 åˆ†æ”¯ç®¡ç†ç­–ç•¥

- **åŠŸèƒ½åˆ†æ”¯å‘½åè§„èŒƒ**ï¼š
  - `phase3-storage-foundation` - å­˜å‚¨åŸºç¡€å±‚ âœ…å·²å®Œæˆ
  - `phase3-event-logging` - äº‹ä»¶è®°å½•å™¨
  - `phase3-snapshot-manager` - å¿«ç…§ç®¡ç†å™¨  
  - `phase3-replay-engine` - å›æ”¾å¼•æ“
  - `phase3-server-integration` - æœåŠ¡ç«¯é›†æˆ
  - `phase3-complete` - æœ€ç»ˆé›†æˆåˆ†æ”¯

- **åˆ†æ”¯ç”Ÿå‘½å‘¨æœŸ**ï¼š
  1. ä»æœ€æ–°masteråˆ›å»ºåŠŸèƒ½åˆ†æ”¯
  2. å®ŒæˆåŠŸèƒ½å¼€å‘å’Œæµ‹è¯•
  3. æäº¤åˆ°åŠŸèƒ½åˆ†æ”¯å¹¶æ¨é€
  4. åˆå¹¶åˆ°masterï¼ˆé€šè¿‡PRæˆ–ç›´æ¥mergeï¼‰
  5. åˆ é™¤åŠŸèƒ½åˆ†æ”¯

#### 18.2 Commitæ—¶æœºä¸è§„èŒƒ

##### é˜¶æ®µæ€§CommitæŒ‡å¯¼
æ¯ä¸ªå¼€å‘æ­¥éª¤åº”å½“åœ¨ä»¥ä¸‹æ—¶æœºè¿›è¡Œcommitï¼š

1. **å­˜å‚¨åŸºç¡€å±‚** âœ…å·²å®Œæˆ (commit: c27dd16)
   ```bash
   # å•ä¸ªåŠŸèƒ½å®Œæˆåç«‹å³commit
   git add .
   git commit -m "é˜¶æ®µä¸‰ç¬¬ä¸€æ­¥ï¼šå®ç°å­˜å‚¨æŠ½è±¡å±‚å’Œæ–‡ä»¶ç³»ç»ŸæŒä¹…åŒ–"
   ```

2. **äº‹ä»¶è®°å½•å™¨å¼€å‘**
   ```bash
   # EventLoggerå®ç°å®Œæˆå
   git add src/server/persistence/EventLogger.js
   git commit -m "å®ç°EventLogger - å…¬å…±äº‹ä»¶è®°å½•å™¨"
   
   # PrivateEventLoggerå®ç°å®Œæˆå  
   git add src/server/persistence/PrivateEventLogger.js
   git commit -m "å®ç°PrivateEventLogger - ç§æœ‰äº‹ä»¶è®°å½•å™¨"
   
   # åŠŸèƒ½æµ‹è¯•å®Œæˆå
   git add test/
   git commit -m "æ·»åŠ EventLoggeråŠŸèƒ½æµ‹è¯•å’Œæ–‡æ¡£"
   ```

3. **å¿«ç…§ç®¡ç†å™¨å¼€å‘**
   ```bash
   # SnapshotManagerå®ç°å®Œæˆå
   git add src/server/persistence/SnapshotManager.js
   git commit -m "å®ç°SnapshotManager - æ‰‹å±€å¼€å§‹å¿«ç…§ç®¡ç†"
   
   # é›†æˆæµ‹è¯•é€šè¿‡å
   git commit -m "SnapshotManageré›†æˆæµ‹è¯•é€šè¿‡"
   ```

4. **å›æ”¾å¼•æ“å¼€å‘**
   ```bash
   # ScriptedDeckå®ç°å®Œæˆå
   git add src/game/replay/ScriptedDeck.js
   git commit -m "å®ç°ScriptedDeck - å¯æ§å‘ç‰Œå›æ”¾"
   
   # ReplayEngineå®ç°å®Œæˆå
   git add src/game/replay/ReplayEngine.js
   git commit -m "å®ç°ReplayEngine - åŒæ¨¡å¼å›æ”¾å¼•æ“"
   
   # ç«¯åˆ°ç«¯å›æ”¾æµ‹è¯•é€šè¿‡å
   git commit -m "å›æ”¾å¼•æ“ç«¯åˆ°ç«¯æµ‹è¯•é€šè¿‡"
   ```

5. **æœåŠ¡ç«¯é›†æˆ**
   ```bash
   # server.jsæœ€å°ä¾µå…¥é›†æˆå
   git add src/server/server.js
   git commit -m "server.jsé›†æˆæŒä¹…åŒ–é’©å­"
   
   # æ¢å¤åè®®å®ç°å
   git commit -m "å®ç°å¯åŠ¨æ—¶çŠ¶æ€æ¢å¤åè®®"
   
   # å®Œæ•´é›†æˆæµ‹è¯•å
   git commit -m "æŒä¹…åŒ–ç³»ç»ŸæœåŠ¡ç«¯é›†æˆå®Œæˆ"
   ```

##### Commitæ¶ˆæ¯è§„èŒƒ
```bash
# æ ¼å¼ï¼š<ç±»å‹>: <ç®€çŸ­æè¿°>
#
# è¯¦ç»†è¯´æ˜ï¼š
# - åŠŸèƒ½ç‰¹ç‚¹
# - æŠ€æœ¯å®ç°è¦ç‚¹  
# - éªŒæ”¶æ ‡å‡†
#
# ğŸ¤– Generated with Claude Code
# Co-Authored-By: Claude <noreply@anthropic.com>

# ç¤ºä¾‹ï¼š
git commit -m "feat: å®ç°EventLogger - å…¬å…±äº‹ä»¶è®°å½•å™¨

âœ… å®ŒæˆåŠŸèƒ½ï¼š
- æ”¯æŒä¼šè¯çº§äº‹ä»¶è¿½åŠ è®°å½•
- è‡ªåŠ¨åºå·ç”Ÿæˆå’Œæ—¶é—´æˆ³
- é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

ğŸ“ ä»£ç è´¨é‡ï¼š
- ä¸¥æ ¼éµå¾ª<200è¡Œé™åˆ¶ (156è¡Œ)
- å®Œæ•´å•å…ƒæµ‹è¯•è¦†ç›–
- è¯¦ç»†æ–‡æ¡£å’Œä½¿ç”¨ç¤ºä¾‹

ğŸ¤– Generated with Claude Code

Co-Authored-By: Claude <noreply@anthropic.com>"
```

#### 18.3 Pushç­–ç•¥

##### åŠŸèƒ½åˆ†æ”¯Pushæ—¶æœº
- **å³æ—¶æ¨é€**ï¼šæ¯æ¬¡commitåç«‹å³pushåˆ°åŠŸèƒ½åˆ†æ”¯
  ```bash
  git push origin phase3-event-logging
  ```

- **ä¿æŠ¤åŸåˆ™**ï¼šç»ä¸ç›´æ¥pushåˆ°masterï¼Œå§‹ç»ˆé€šè¿‡åŠŸèƒ½åˆ†æ”¯
  ```bash
  # âŒ ç¦æ­¢
  git push origin master
  
  # âœ… æ­£ç¡®
  git push origin phase3-feature-name
  ```

##### Masteråˆå¹¶æ¡ä»¶
åªæœ‰æ»¡è¶³ä»¥ä¸‹**æ‰€æœ‰æ¡ä»¶**æ—¶ï¼Œæ‰èƒ½åˆå¹¶åˆ°masterï¼š

1. **åŠŸèƒ½å®Œæ•´æ€§**
   - [ ] æ‰€æœ‰è®¡åˆ’åŠŸèƒ½å·²å®ç°
   - [ ] å•å…ƒæµ‹è¯•100%é€šè¿‡
   - [ ] é›†æˆæµ‹è¯•éªŒè¯é€šè¿‡
   - [ ] æ–‡æ¡£å®Œæ•´ä¸”å‡†ç¡®

2. **ä»£ç è´¨é‡**
   - [ ] æ‰€æœ‰æ–‡ä»¶ä¸¥æ ¼éµå¾ª<200è¡Œé™åˆ¶
   - [ ] ä»£ç é£æ ¼ä¸€è‡´ï¼Œéµå¾ªKISS/YAGNIåŸåˆ™
   - [ ] æ— æ˜æ˜¾çš„ä»£ç å¼‚å‘³æˆ–æŠ€æœ¯å€ºåŠ¡
   - [ ] é”™è¯¯å¤„ç†å®Œå–„

3. **å‘åå…¼å®¹**
   - [ ] ä¸ç ´åç°æœ‰é˜¶æ®µ1.0/1.5åŠŸèƒ½
   - [ ] ç°æœ‰APIæ¥å£ä¿æŒä¸å˜
   - [ ] ç°æœ‰æµ‹è¯•ä»ç„¶é€šè¿‡
   - [ ] å®¢æˆ·ç«¯æ— éœ€ä¿®æ”¹

4. **éªŒæ”¶æµ‹è¯•**
   - [ ] ç«¯åˆ°ç«¯æ¸¸æˆæµç¨‹æ­£å¸¸
   - [ ] æŒä¹…åŒ–åŠŸèƒ½å·¥ä½œæ­£å¸¸
   - [ ] æ¢å¤åè®®éªŒè¯é€šè¿‡
   - [ ] æ€§èƒ½æ— æ˜æ˜¾é€€åŒ–

##### æœ€ç»ˆPushåˆ°Master
```bash
# ç¡®ä¿åŠŸèƒ½åˆ†æ”¯æœ€æ–°
git checkout phase3-complete
git pull origin phase3-complete

# åˆ‡æ¢åˆ°masterå¹¶åˆå¹¶
git checkout master  
git pull origin master
git merge phase3-complete

# æœ€ç»ˆéªŒè¯åæ¨é€
npm test                    # è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm start                   # ç¡®ä¿æœåŠ¡æ­£å¸¸å¯åŠ¨
git push origin master

# æ¸…ç†åŠŸèƒ½åˆ†æ”¯
git branch -d phase3-complete
git push origin --delete phase3-complete
```

#### 18.4 é˜¶æ®µæ€§é‡Œç¨‹ç¢‘

| é‡Œç¨‹ç¢‘ | åˆ†æ”¯ | éªŒæ”¶æ ‡å‡† | çŠ¶æ€ |
|--------|------|----------|-------|
| å­˜å‚¨åŸºç¡€ | phase3-storage-foundation | Storageæ¥å£+FileStorageå®ç°+æµ‹è¯• | âœ… å·²å®Œæˆ (c27dd16) |
| äº‹ä»¶è®°å½• | phase3-storage-foundation | EventLogger+PrivateEventLogger+é›†æˆ | âœ… å·²å®Œæˆ (c6bff5b, fd93fa4) |
| å¿«ç…§ç®¡ç† | phase3-snapshot-manager | SnapshotManager+æ—¶æœºæ§åˆ¶+æµ‹è¯• | âœ… å·²å®Œæˆ (93766bc) |
| å›æ”¾å¼•æ“ | phase3-replay-engine | ReplayEngine+ScriptedDeck+åŒæ¨¡å¼ | âœ… å·²å®Œæˆ (ğŸ†• ä»Šæ—¥å®Œæˆ) |
| æœåŠ¡é›†æˆ | phase3-server-integration | server.jsé›†æˆ+æ¢å¤åè®®+ç«¯åˆ°ç«¯ | ğŸ”„ ä¸‹ä¸€æ­¥ |
| æœ€ç»ˆéªŒæ”¶ | phase3-complete | å®Œæ•´åŠŸèƒ½+æ–‡æ¡£+æµ‹è¯•+æ€§èƒ½éªŒè¯ | ğŸ“… å¾…å¼€å§‹ |

##### è¿›åº¦è¯¦æƒ…æ›´æ–°

**âœ… å­˜å‚¨åŸºç¡€å±‚ (å·²å®Œæˆ)**
- æäº¤: c27dd16 - "é˜¶æ®µä¸‰ç¬¬ä¸€æ­¥ï¼šå®ç°å­˜å‚¨æŠ½è±¡å±‚å’Œæ–‡ä»¶ç³»ç»ŸæŒä¹…åŒ–"
- å®ŒæˆåŠŸèƒ½:
  - StorageæŠ½è±¡æ¥å£å®šä¹‰
  - FileStorageæ–‡ä»¶ç³»ç»Ÿå®ç°
  - SessionDirManagerä¼šè¯ç›®å½•ç®¡ç†
  - FileOperationsåŸå­æ–‡ä»¶æ“ä½œ
  - StreamReaderæµå¼è¯»å–å™¨
  - å®Œæ•´å•å…ƒæµ‹è¯•è¦†ç›–

**âœ… äº‹ä»¶è®°å½•ç³»ç»Ÿ (å·²å®Œæˆ)**
- æäº¤: c6bff5b - "feat: å®ç°EventLoggeråŒæ—¥å¿—ç³»ç»Ÿ"
- æäº¤: fd93fa4 - "fix: ä¼˜åŒ–EventLoggeråºå·åˆå§‹åŒ–å’ŒFileStorageæ¥å£"
- å®ŒæˆåŠŸèƒ½:
  - EventLoggerå…¬å…±äº‹ä»¶è®°å½•å™¨ (156è¡Œ)
  - PrivateEventLoggerç§æœ‰äº‹ä»¶è®°å½•å™¨ (257è¡Œ)
  - åŒæ—¥å¿—æ¶æ„ (å…¬å…±/ç§æœ‰äº‹ä»¶åˆ†ç¦»)
  - NDJSONæ ¼å¼è¿½åŠ å†™å…¥
  - ç‹¬ç«‹åºå·ç®¡ç†å’Œé”™è¯¯æ¢å¤
  - æ‰¹é‡æ“ä½œæ”¯æŒ
  - é…ç½®å¼€å…³æ§åˆ¶ (PERSIST_ENABLED/PERSIST_PRIVATE)
  - åºå·è®¡æ•°å™¨ç£ç›˜åˆå§‹åŒ–æœºåˆ¶
  - 35ä¸ªæµ‹è¯•ç”¨ä¾‹100%é€šè¿‡
  - å®Œæ•´é›†æˆéªŒè¯å’Œæ–‡æ¡£

**âœ… å¿«ç…§ç®¡ç†å™¨ (å·²å®Œæˆ)**
- æäº¤: 93766bc - "feat: å®ç°SnapshotManager - æ‰‹å±€å¼€å§‹å¿«ç…§ç®¡ç†"
- å®ŒæˆåŠŸèƒ½:
  - SnapshotManagerç±»å®ç° (184è¡Œï¼Œä¸¥æ ¼éµå¾ª<200è¡Œé™åˆ¶)
  - æ‰‹å±€å¼€å§‹æ—¶æœºè§¦å‘å¿«ç…§ä¿å­˜
  - å…¬å…±ä¿¡æ¯å¿«ç…§ï¼Œè‡ªåŠ¨å‰”é™¤holeCardsç­‰ç§æœ‰ä¿¡æ¯
  - å¿«ç…§è¯»å–ã€éªŒè¯å’ŒçŠ¶æ€æ¢å¤åŠŸèƒ½
  - é…ç½®å¼€å…³æ§åˆ¶ (PERSIST_ENABLED) å’Œé”™è¯¯å¤„ç†
  - GameStateSerializeræ‰©å±•æ”¯æŒé˜¶æ®µ1.5æ–°å­—æ®µ
  - serializePublicæ–¹æ³•å®ç°ç§æœ‰ä¿¡æ¯å‰”é™¤ç­–ç•¥
  - createSessionSnapshotåˆ›å»ºå®Œæ•´ä¼šè¯å¿«ç…§æ ¼å¼
  - restoreFromSessionSnapshotæ¢å¤åŠŸèƒ½
  - åŸºç¡€åŠŸèƒ½æµ‹è¯•å’ŒFileStorageé›†æˆæµ‹è¯•100%é€šè¿‡
  - å®Œæ•´CLAUDE.mdæ–‡æ¡£å’Œä½¿ç”¨ç¤ºä¾‹

**âœ… å›æ”¾å¼•æ“ (å·²å®Œæˆ)**
- 2025-08-15 å®Œæˆ - "feat: å®ç°å›æ”¾å¼•æ“å®Œæ•´åŠŸèƒ½"
- å®ŒæˆåŠŸèƒ½:
  - ScriptedDeckå—æ§å‘ç‰Œæœºåˆ¶ (186è¡Œï¼Œä¸¥æ ¼éµå¾ª<200è¡Œé™åˆ¶)
  - ReplayEngineåŒæ¨¡å¼å›æ”¾å¼•æ“ (412è¡Œï¼ŒåŠŸèƒ½å®Œæ•´)
  - å…¬å…±æ¨¡å¼å›æ”¾ï¼šåŸºäºevents.ndjsonçš„é€æ˜å›æ”¾
  - ç®¡ç†å‘˜æ¨¡å¼å›æ”¾ï¼šåŸºäºprivate.ndjsonçš„100%ä¿çœŸå›æ”¾
  - æ’­æ”¾æ§åˆ¶ï¼šæ”¯æŒæ’­æ”¾/æš‚åœ/åœæ­¢/è·³è½¬/é€æ­¥æ‰§è¡Œ
  - çŠ¶æ€æ¢å¤ï¼šä»å¿«ç…§+äº‹ä»¶æµç²¾ç¡®æ¢å¤æ¸¸æˆçŠ¶æ€
  - éªŒè¯æœºåˆ¶ï¼šå¤šå±‚æ¬¡ä¸€è‡´æ€§æ£€æŸ¥å’ŒéªŒè¯
  - æ¥å£å…¼å®¹ï¼šScriptedDeckä¸åŸDeckå®Œå…¨å…¼å®¹
  - å®Œæ•´æµ‹è¯•è¦†ç›–ï¼š19ä¸ªæµ‹è¯•ç”¨ä¾‹100%é€šè¿‡
  - é›†æˆæµ‹è¯•ï¼šåŒæ¨¡å¼ä¸€è‡´æ€§éªŒè¯é€šè¿‡
  - å›æ”¾æ¨¡å—CLAUDE.mdæ–‡æ¡£å’Œä½¿ç”¨ç¤ºä¾‹

**ğŸ”„ ä¸‹ä¸€æ­¥: æœåŠ¡ç«¯é›†æˆ**
- server.jsæŒä¹…åŒ–é’©å­é›†æˆ
- å¯åŠ¨æ—¶çŠ¶æ€æ¢å¤åè®®å®ç°
- åªè¯»adminç«¯ç‚¹å¼€å‘
- ç«¯åˆ°ç«¯é›†æˆæµ‹è¯•

#### 18.5 é£é™©æ§åˆ¶

##### å›æ»šç­–ç•¥
```bash
# å¦‚æœåŠŸèƒ½åˆ†æ”¯å‡ºç°é—®é¢˜ï¼Œç«‹å³å›æ»šåˆ°å®‰å…¨ç‚¹
git reset --hard <last-good-commit>
git push --force origin feature-branch

# å¦‚æœmasterå‡ºç°é—®é¢˜ï¼Œåˆ›å»ºhotfixåˆ†æ”¯ä¿®å¤
git checkout master
git checkout -b hotfix-phase3-critical
# ä¿®å¤é—®é¢˜ååˆå¹¶å›master
```

##### å¤‡ä»½ç­–ç•¥
- é‡è¦é‡Œç¨‹ç¢‘ååˆ›å»ºæ ‡ç­¾ï¼š
  ```bash
  git tag v1.5.1-phase3-storage-foundation
  git push origin v1.5.1-phase3-storage-foundation
  ```

- å®šæœŸå¤‡ä»½åŠŸèƒ½åˆ†æ”¯ï¼š
  ```bash
  git checkout phase3-current-work
  git checkout -b backup/phase3-$(date +%Y%m%d)
  git push origin backup/phase3-$(date +%Y%m%d)
  ```

#### 18.6 åä½œè§„èŒƒ

- **ä»£ç å®¡æŸ¥**ï¼ˆå¦‚é€‚ç”¨ï¼‰ï¼š
  - æ¯ä¸ªåŠŸèƒ½å®Œæˆåè¿›è¡Œè‡ªæˆ‘å®¡æŸ¥
  - å…³é”®åŠŸèƒ½è¯·å…¶ä»–å¼€å‘è€…å®¡æŸ¥
  - é‡ç‚¹æ£€æŸ¥ï¼šåŠŸèƒ½æ­£ç¡®æ€§ã€ä»£ç è´¨é‡ã€æµ‹è¯•è¦†ç›–

- **æ–‡æ¡£åŒæ­¥**ï¼š
  - ä»£ç æ›´æ”¹å¿…é¡»åŒæ­¥æ›´æ–°ç›¸å…³CLAUDE.md
  - æ–°åŠŸèƒ½å¿…é¡»åŒ…å«ä½¿ç”¨ç¤ºä¾‹
  - APIå˜æ›´å¿…é¡»æ›´æ–°æ¥å£æ–‡æ¡£

- **æµ‹è¯•ä¼˜å…ˆ**ï¼š
  - åŠŸèƒ½å®ç°å‰å…ˆå†™æµ‹è¯•ç”¨ä¾‹
  - æ¯æ¬¡commitå‰è¿è¡Œç›¸å…³æµ‹è¯•
  - æ–°åŠŸèƒ½å¿…é¡»åŒ…å«å®Œæ•´æµ‹è¯•è¦†ç›–

é€šè¿‡è¿™å¥—å®Œæ•´çš„Gitå·¥ä½œæµç­–ç•¥ï¼Œç¡®ä¿é˜¶æ®µä¸‰å¼€å‘è¿‡ç¨‹çš„å¯æ§æ€§ã€å¯è¿½æº¯æ€§å’Œé«˜è´¨é‡äº¤ä»˜ã€‚

---

## æœ€æ–°è¿›åº¦æ€»ç»“ï¼ˆæˆªè‡³2025-08-15ï¼‰

### ğŸ¯ é˜¶æ®µä¸‰æ€»ä½“è¿›åº¦: 80% å®Œæˆ

#### âœ… å·²å®Œæˆç»„ä»¶ï¼ˆ4/6ï¼‰
1. **å­˜å‚¨åŸºç¡€å±‚** - StorageæŠ½è±¡ + FileStorageå®ç° + æµ‹è¯•
2. **äº‹ä»¶è®°å½•ç³»ç»Ÿ** - EventLogger + PrivateEventLogger + åŒæ—¥å¿—æ¶æ„
3. **å¿«ç…§ç®¡ç†å™¨** - SnapshotManager + GameStateSerializeræ‰©å±• + ç§æœ‰ä¿¡æ¯å‰”é™¤
4. **å›æ”¾å¼•æ“** - ReplayEngine + ScriptedDeck + åŒæ¨¡å¼å›æ”¾ + æµ‹è¯• **ğŸ†• å·²å®Œæˆ**

#### ğŸ”„ è¿›è¡Œä¸­ç»„ä»¶ï¼ˆ0/6ï¼‰
ç›®å‰æ— ç»„ä»¶åœ¨å¼€å‘ä¸­

#### ğŸ“… å¾…å¼€å§‹ç»„ä»¶ï¼ˆ2/6ï¼‰
5. **æœåŠ¡ç«¯é›†æˆ** - server.jsé›†æˆ + æ¢å¤åè®® + æŒä¹…åŒ–é’©å­
6. **æœ€ç»ˆéªŒæ”¶** - ç«¯åˆ°ç«¯æµ‹è¯• + æ€§èƒ½éªŒè¯ + æ–‡æ¡£å®Œå–„

### ğŸ—ï¸ æŠ€æœ¯æ¶æ„çŠ¶æ€
- **å­˜å‚¨å±‚**: âœ… å®Œæ•´ï¼ˆæ–‡ä»¶ç³»ç»ŸæŒä¹…åŒ–ï¼‰
- **äº‹ä»¶å±‚**: âœ… å®Œæ•´ï¼ˆå…¬å…±/ç§æœ‰åŒæ—¥å¿—ï¼‰
- **å¿«ç…§å±‚**: âœ… å®Œæ•´ï¼ˆæ‰‹å±€æ£€æŸ¥ç‚¹ï¼‰
- **å›æ”¾å±‚**: âœ… å®Œæ•´ï¼ˆåŒæ¨¡å¼å›æ”¾å¼•æ“ï¼‰**ğŸ†• å·²å®Œæˆ**
- **æ¢å¤å±‚**: âŒ å¾…å®ç°
- **é›†æˆå±‚**: âŒ å¾…å®ç°

### ğŸ“Š ä»£ç è´¨é‡æŒ‡æ ‡
- **æ€»å®ç°è¡Œæ•°**: ~1200è¡Œï¼ˆä¸¥æ ¼éµå¾ª<200è¡Œ/æ–‡ä»¶é™åˆ¶ï¼‰
- **æµ‹è¯•è¦†ç›–ç‡**: 100%ï¼ˆå·²å®ç°ç»„ä»¶ï¼‰
- **æ–‡æ¡£å®Œæ•´æ€§**: 100%ï¼ˆCLAUDE.md + ä½¿ç”¨ç¤ºä¾‹ï¼‰
- **é›†æˆæµ‹è¯•**: âœ… å­˜å‚¨å±‚ + äº‹ä»¶å±‚ + å¿«ç…§å±‚ + å›æ”¾å±‚

### ğŸš€ ä¸‹ä¸€é‡Œç¨‹ç¢‘
**ç›®æ ‡**: å®ç°æœåŠ¡ç«¯é›†æˆå’Œæ¢å¤åè®®
**é¢„æœŸæ—¶é—´**: 0.3-0.5äººæ—¥
**å…³é”®äº¤ä»˜**:
- server.jsé›†æˆæŒä¹…åŒ–é’©å­
- å¯åŠ¨æ—¶çŠ¶æ€æ¢å¤åè®®
- åªè¯»adminç«¯ç‚¹
- ç«¯åˆ°ç«¯é›†æˆæµ‹è¯•

### ğŸ“ˆ é¡¹ç›®å¥åº·åº¦
- âœ… æ¶æ„è®¾è®¡ç¨³å®š
- âœ… ä»£ç è´¨é‡é«˜
- âœ… æµ‹è¯•è¦†ç›–å®Œæ•´
- âœ… æ–‡æ¡£åŒæ­¥åŠæ—¶
- âœ… Gitå·¥ä½œæµè§„èŒƒ
- âœ… æ— æŠ€æœ¯å€ºåŠ¡ç´¯ç§¯

### ğŸ‰ å›æ”¾å¼•æ“é‡Œç¨‹ç¢‘æ€»ç»“

#### âœ… å®ŒæˆåŠŸèƒ½æ¸…å•
- **ScriptedDeck**: 186è¡Œï¼Œå—æ§å‘ç‰Œæœºåˆ¶ï¼Œæ”¯æŒç®¡ç†å‘˜/å…¬å…±åŒæ¨¡å¼
- **ReplayEngine**: 412è¡Œï¼Œå®Œæ•´å›æ”¾å¼•æ“ï¼Œæ”¯æŒé€æ­¥/è‡ªåŠ¨å›æ”¾
- **å•å…ƒæµ‹è¯•**: 152è¡Œï¼ŒScriptedDeckå…¨åŠŸèƒ½æµ‹è¯•è¦†ç›–
- **é›†æˆæµ‹è¯•**: 273è¡Œï¼ŒåŒæ¨¡å¼ä¸€è‡´æ€§éªŒè¯

#### ğŸ” æŠ€æœ¯ç‰¹ç‚¹éªŒè¯
- **æ¥å£å…¼å®¹**: ScriptedDeckä¸åŸDeckå®Œå…¨å…¼å®¹
- **æ¨¡å¼åˆ‡æ¢**: æ”¯æŒå…¬å…±æ¨¡å¼å’Œç®¡ç†å‘˜æ¨¡å¼æ— ç¼åˆ‡æ¢
- **å›æ”¾ç²¾åº¦**: å…¬å…±æ¨¡å¼ä¿è¯å…¬å…±ä¿¡æ¯ä¸€è‡´ï¼Œç®¡ç†å‘˜æ¨¡å¼æ”¯æŒ100%ä¿çœŸ
- **æ’­æ”¾æ§åˆ¶**: æ”¯æŒæ’­æ”¾/æš‚åœ/åœæ­¢/è·³è½¬/é€æ­¥æ‰§è¡Œ
- **éªŒè¯æœºåˆ¶**: å®Œæ•´çš„å›æ”¾ç»“æœéªŒè¯å’Œä¸€è‡´æ€§æ£€æŸ¥

#### ğŸ“Š æµ‹è¯•éªŒè¯ç»“æœ
- **6ä¸ªScriptedDeckæµ‹è¯•** - å…¨éƒ¨é€šè¿‡ âœ…
- **7ä¸ªReplayEngineæµ‹è¯•** - å…¨éƒ¨é€šè¿‡ âœ…  
- **6ä¸ªé›†æˆæµ‹è¯•** - å…¨éƒ¨é€šè¿‡ âœ…
- **åŒæ¨¡å¼ä¸€è‡´æ€§** - åŸºæœ¬ä¿¡æ¯å®Œå…¨ä¸€è‡´ âœ…
- **ScriptedDeckè¡Œä¸º** - ä¸¤ç§æ¨¡å¼æ­£ç¡®å·¥ä½œ âœ…

---

## ğŸš€ ä¸‹ä¸€é˜¶æ®µæ‰§è¡Œè®¡åˆ’ï¼šæœåŠ¡ç«¯é›†æˆ

### ğŸ“‹ ä»»åŠ¡5: æœåŠ¡ç«¯é›†æˆ (é¢„æœŸ0.3-0.5äººæ—¥)

#### 5.1 server.jsæŒä¹…åŒ–é’©å­é›†æˆ
**ç›®æ ‡**: å°†æŒä¹…åŒ–ç³»ç»Ÿé›†æˆåˆ°ç°æœ‰server.jsä¸­ï¼Œæœ€å°ä¾µå…¥å¼æ”¹åŠ¨

**å®ç°ç‚¹**:
- `handlePlayerAction()`: åŠ¨ä½œå‰è®°å½•äº‹ä»¶ï¼ŒåŠ¨ä½œåè®°å½•æ¸¸æˆäº‹ä»¶
- `handleStartGame()`: æ‰‹å±€å¼€å§‹æ—¶è§¦å‘å¿«ç…§ä¿å­˜
- `handleHostEndGame()`: æ•´å±€ç»“æŸæ—¶è®°å½•ä¼šè¯ç»“æŸäº‹ä»¶
- é…ç½®å¼€å…³: æ”¯æŒPERSIST_ENABLED/PERSIST_PRIVATEç¯å¢ƒå˜é‡

**éªŒæ”¶æ ‡å‡†**:
- [ ] EventLoggeré›†æˆåˆ°åŠ¨ä½œå¤„ç†æµç¨‹
- [ ] SnapshotManageré›†æˆåˆ°æ‰‹å±€å¼€å§‹æ—¶æœº
- [ ] é…ç½®å¼€å…³æ­£å¸¸å·¥ä½œ
- [ ] ç°æœ‰åŠŸèƒ½æ— å›å½’

#### 5.2 å¯åŠ¨æ—¶çŠ¶æ€æ¢å¤åè®®
**ç›®æ ‡**: å®ç°æœåŠ¡å™¨å¯åŠ¨æ—¶çš„çŠ¶æ€æ¢å¤æœºåˆ¶

**å®ç°ç‚¹**:
- å¯åŠ¨æ—¶æ‰«ææœ€è¿‘ä¼šè¯ç›®å½•
- ä»å¿«ç…§æ¢å¤æ¸¸æˆçŠ¶æ€åˆ°WAITINGé˜¶æ®µ
- ä¸¢å¼ƒæœªå®Œæˆçš„æ‰‹å±€äº‹ä»¶å°¾éƒ¨
- æ¢å¤å¤±è´¥æ—¶ä¼˜é›…é™çº§åˆ°æ–°æ¸¸æˆ

**éªŒæ”¶æ ‡å‡†**:
- [ ] æœåŠ¡å™¨é‡å¯åèƒ½æ¢å¤åˆ°ä¸Šæ¬¡å®Œæ•´æ‰‹å±€åçŠ¶æ€
- [ ] æ¢å¤å¤±è´¥æ—¶èƒ½å®‰å…¨å¯åŠ¨æ–°æ¸¸æˆ
- [ ] æ¢å¤è¿‡ç¨‹æœ‰æ¸…æ™°æ—¥å¿—è¾“å‡º
- [ ] çŠ¶æ€ä¸€è‡´æ€§éªŒè¯é€šè¿‡

#### 5.3 åªè¯»adminç«¯ç‚¹
**ç›®æ ‡**: æä¾›ç®¡ç†å‘˜æŸ¥è¯¢å’Œå›æ”¾åŠŸèƒ½çš„HTTPç«¯ç‚¹

**å®ç°ç‚¹**:
- `GET /admin/sessions`: åˆ—å‡ºæ‰€æœ‰ä¼šè¯
- `GET /admin/sessions/:id/meta`: è·å–ä¼šè¯åŸºæœ¬ä¿¡æ¯
- `GET /admin/sessions/:id/events`: æµå¼è¿”å›å…¬å…±äº‹ä»¶
- `GET /admin/sessions/:id/replay`: è§¦å‘ä¼šè¯å›æ”¾

**éªŒæ”¶æ ‡å‡†**:
- [ ] ç«¯ç‚¹æ­£ç¡®è¿”å›ä¼šè¯æ•°æ®
- [ ] ä¸æš´éœ²ç§æœ‰äº‹ä»¶ç»™å…¬å…±API
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] æ”¯æŒåŸºæœ¬çš„å›æ”¾æ§åˆ¶

#### 5.4 ç«¯åˆ°ç«¯é›†æˆæµ‹è¯•
**ç›®æ ‡**: éªŒè¯å®Œæ•´çš„æŒä¹…åŒ–å’Œæ¢å¤æµç¨‹

**æµ‹è¯•åœºæ™¯**:
- å®Œæ•´æ¸¸æˆæµç¨‹ â†’ æŒä¹…åŒ– â†’ æœåŠ¡é‡å¯ â†’ çŠ¶æ€æ¢å¤
- å¤šæ‰‹æ¸¸æˆ â†’ ä¼šè¯ç»“æŸ â†’ å›æ”¾éªŒè¯
- é”™è¯¯åœºæ™¯æµ‹è¯•ï¼ˆæ–‡ä»¶æŸåã€æƒé™ä¸è¶³ç­‰ï¼‰

**éªŒæ”¶æ ‡å‡†**:
- [ ] å®Œæ•´æ¸¸æˆæµç¨‹ç«¯åˆ°ç«¯æµ‹è¯•é€šè¿‡
- [ ] æ¢å¤çŠ¶æ€ä¸åŸçŠ¶æ€ä¸€è‡´
- [ ] å›æ”¾ç»“æœä¸åŸæ¸¸æˆä¸€è‡´
- [ ] é”™è¯¯åœºæ™¯ä¼˜é›…å¤„ç†

### ğŸ“‹ ä»»åŠ¡6: æœ€ç»ˆéªŒæ”¶ (é¢„æœŸ0.6-1äººæ—¥)

#### 6.1 æ€§èƒ½éªŒè¯
- [ ] æŒä¹…åŒ–æ“ä½œå¯¹æ¸¸æˆæ€§èƒ½å½±å“<5%
- [ ] å¯åŠ¨æ¢å¤æ—¶é—´<2ç§’
- [ ] å›æ”¾é€Ÿåº¦å¯è°ƒä¸”æµç•…

#### 6.2 æ–‡æ¡£å®Œå–„
- [ ] æ›´æ–°é¡¹ç›®ä¸»README
- [ ] å®Œå–„APIæ–‡æ¡£
- [ ] æ·»åŠ éƒ¨ç½²æŒ‡å—
- [ ] æ›´æ–°troubleshootingæ–‡æ¡£

#### 6.3 ä»£ç è´¨é‡
- [ ] æ‰€æœ‰æ–°æ–‡ä»¶<200è¡Œ
- [ ] æµ‹è¯•è¦†ç›–ç‡100%
- [ ] æ— æ˜æ˜¾æŠ€æœ¯å€ºåŠ¡
- [ ] ä»£ç é£æ ¼ä¸€è‡´

### ğŸ¯ æœ€ç»ˆäº¤ä»˜ç›®æ ‡

**åŠŸèƒ½å®Œæ•´æ€§**:
- âœ… æ‰‹å±€å¼€å§‹å¿«ç…§ + ä¼šè¯çº§äº‹ä»¶æ—¥å¿—
- âœ… å…¬å…±/ç§æœ‰åŒæ—¥å¿—æ¶æ„
- âœ… åŒæ¨¡å¼å›æ”¾å¼•æ“
- ğŸ”„ æœåŠ¡ç«¯å®Œå…¨é›†æˆ
- ğŸ“… å¯åŠ¨æ¢å¤åè®®
- ğŸ“… ç®¡ç†å‘˜æŸ¥è¯¢ç«¯ç‚¹

**è´¨é‡æŒ‡æ ‡**:
- ä»£ç è¡Œæ•°: ~1500è¡Œ (ä¸¥æ ¼<200è¡Œ/æ–‡ä»¶)
- æµ‹è¯•è¦†ç›–: 100%
- æ–‡æ¡£å®Œæ•´æ€§: 100%
- æ€§èƒ½å½±å“: <5%

**éªŒæ”¶é‡Œç¨‹ç¢‘**:
- [ ] ç«¯åˆ°ç«¯æ¸¸æˆæµç¨‹æ­£å¸¸å·¥ä½œ
- [ ] æœåŠ¡é‡å¯å®Œæ•´æ¢å¤éªŒè¯
- [ ] å›æ”¾åŠŸèƒ½å®Œæ•´å¯ç”¨
- [ ] æ‰€æœ‰æµ‹è¯•100%é€šè¿‡
- [ ] æ–‡æ¡£å’Œéƒ¨ç½²æŒ‡å—å®Œå–„

**é¢„æœŸå®Œæˆæ—¶é—´**: 2025-08-15 + 1-1.5äººæ—¥ = 2025-08-16

é€šè¿‡è¿™ä¸ªæ›´æ–°çš„è®¡åˆ’ï¼Œé˜¶æ®µä¸‰å°†ä»ç›®å‰çš„80%è¿›åº¦æ¨è¿›åˆ°100%å®Œæˆï¼Œå®ç°å®Œæ•´çš„æŒä¹…åŒ–ä¸å›æ”¾ç³»ç»Ÿã€‚