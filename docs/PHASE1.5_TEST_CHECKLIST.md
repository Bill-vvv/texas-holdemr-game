# 阶段1.5功能测试清单

## 测试环境
- 服务器地址: http://localhost:3002
- 浏览器: Chrome/Firefox/Safari（建议使用开发者工具）
- 测试人数: 至少2人（可以开多个浏览器标签页模拟）

## Feature A: 摊牌结果展示测试

### 测试步骤
1. **准备阶段**
   - [ ] 在多个浏览器标签页中加入游戏（至少2人）
   - [ ] 确认房主身份（第一个加入的玩家）
   - [ ] 房主点击"开始游戏"开始第一手牌

2. **进行游戏**
   - [ ] 让游戏进行到摊牌阶段（SHOWDOWN）
   - [ ] 可以通过以下方式快速到达摊牌：
     - 翻牌前所有人跟注（call）
     - 翻牌圈所有人过牌（check）
     - 转牌圈所有人过牌（check）
     - 河牌圈所有人过牌（check）

3. **验证摊牌结果展示**
   - [ ] 游戏自动进入摊牌阶段
   - [ ] 页面显示"🏆 获胜者"区域
   - [ ] 显示获胜者姓名
   - [ ] 显示获胜牌型（如"一对"、"两对"、"三条"等中文名称）
   - [ ] 显示最佳五张牌组合
   - [ ] 显示使用的底牌信息
   - [ ] 摊牌结果展示完整且易于理解

### 预期结果
```
🏆 获胜者
[玩家名称]
牌型: 一对
最佳五张: A♠ A♥ K♦ Q♣ J♥
使用底牌: A♠ K♦
```

## Feature B: 房主手动结束整局测试

### 测试步骤
1. **权限验证**
   - [ ] 只有房主能看到"结束整局"按钮（红色）
   - [ ] 非房主玩家界面不显示该按钮
   - [ ] 按钮仅在游戏进行中显示（phase=PLAYING）

2. **结束整局操作**
   - [ ] 房主点击"结束整局"按钮
   - [ ] 弹出确认对话框："确定要结束整局吗？..."
   - [ ] 点击"确定"执行结束操作
   - [ ] 点击"取消"应该取消操作

3. **验证整局结算展示**
   - [ ] 所有玩家同时收到结束通知
   - [ ] 页面显示"📊 整局结算"区域
   - [ ] 显示会话基本信息：
     - [ ] 会话ID
     - [ ] 游戏时长（分钟）
     - [ ] 总手数
     - [ ] 总筹码数
   - [ ] 显示玩家结算表格：
     - [ ] 玩家姓名
     - [ ] 初始买入金额
     - [ ] 当前筹码数
     - [ ] 盈亏情况（绿色盈利/红色亏损）

### 预期结果
```
📊 整局结算
会话ID: session_1692345678901
游戏时长: 15 分钟  
总手数: 8
总筹码: 3000

玩家结算:
| 玩家 | 初始 | 当前 | 盈亏 |
|------|------|------|------|
| Alice| 1000 | 1500 | +500 |
| Bob  | 1000 | 800  | -200 |
| Charlie| 1000| 700  | -300 |
```

## 服务端日志验证

### 检查服务端控制台输出
- [ ] 摊牌时显示POTS_DISTRIBUTED事件
- [ ] 房主结束整局时显示相应日志
- [ ] 无错误或异常信息

### 预期日志内容
```
游戏事件: SHOWDOWN_STARTED
游戏事件: POTS_DISTRIBUTED
房主 [playerId] 结束了整局
```

## 浏览器网络验证

### WebSocket消息检查
1. **打开浏览器开发者工具**
   - [ ] Network标签 > WS (WebSocket)
   - [ ] 查看Socket.IO连接

2. **验证消息类型**
   - [ ] 摊牌时收到包含lastShowdownSummary的game_state消息
   - [ ] 房主操作时发送host_end_game消息
   - [ ] 收到game_ended消息包含完整结算数据

### 预期消息格式
```javascript
// 摊牌后的游戏状态
{
  type: "game_state",
  data: {
    lastShowdownSummary: [{
      playerId: "player1",
      rankName: "一对",
      bestFive: ["AS", "AH", "KD", "QC", "JH"],
      usedHole: ["AS", "KD"]
    }]
  }
}

// 整局结束消息
{
  type: "game_ended", 
  data: {
    sessionId: "session_123",
    handsPlayed: 8,
    perPlayer: [...]
  }
}
```

## 错误情况测试

### 权限验证
- [ ] 非房主尝试结束整局应该被阻止
- [ ] 未初始化会话时结束整局应返回错误

### 边界情况
- [ ] 只有1人时无法摊牌（游戏直接结束）
- [ ] 游戏等待状态时结束整局按钮不显示
- [ ] 网络断开重连后功能正常

## 测试结果记录

### Feature A测试结果
- [ ] ✅ 通过
- [ ] ❌ 失败（请记录问题详情）

### Feature B测试结果  
- [ ] ✅ 通过
- [ ] ❌ 失败（请记录问题详情）

### 整体评估
- [ ] 所有功能正常工作
- [ ] 用户体验良好
- [ ] 无明显Bug或异常

## 问题记录

如发现问题，请记录：
1. **问题描述**: 
2. **重现步骤**: 
3. **预期结果**: 
4. **实际结果**: 
5. **浏览器环境**: 
6. **错误信息**: 

---

**测试完成标志**: 当两个主要功能都能正常工作，并且用户体验良好时，阶段1.5测试通过。