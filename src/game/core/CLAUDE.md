# Core æ¨¡å—æ–‡æ¡£

## æ¨¡å—æ¦‚è¿°
coreç›®å½•åŒ…å«å¾·å·æ‰‘å…‹æ¸¸æˆçš„åŸºç¡€æ ¸å¿ƒç»„ä»¶ï¼Œæä¾›ç‰Œå †ç®¡ç†å’Œç‰ŒåŠ›è¯„ä¼°çš„åº•å±‚åŠŸèƒ½ï¼Œæ˜¯æ•´ä¸ªæ¸¸æˆç³»ç»Ÿçš„åŸºçŸ³ã€‚

---

# Deck æ¨¡å—æ–‡æ¡£

## æ¦‚è¿°
Deckæ¨¡å—è´Ÿè´£å¾·å·æ‰‘å…‹çš„ç‰Œå †ç®¡ç†ï¼Œæä¾›æ ‡å‡†52å¼ ç‰Œçš„åˆ›å»ºã€æ´—ç‰Œã€å‘ç‰Œç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚è¿™æ˜¯ä¸€ä¸ªæ— çŠ¶æ€çš„çº¯åŠŸèƒ½ç±»ï¼Œç¡®ä¿ç‰Œå †æ“ä½œçš„å¯é æ€§å’Œå¯æµ‹è¯•æ€§ã€‚

## åŠŸèƒ½ç‰¹æ€§
- æ ‡å‡†52å¼ ç‰Œåˆå§‹åŒ–
- Fisher-Yatesæ´—ç‰Œç®—æ³•
- å•å¼ å’Œæ‰¹é‡å‘ç‰Œ
- å‰©ä½™ç‰Œæ•°æŸ¥è¯¢
- ç‰Œå †çŠ¶æ€æ£€æŸ¥
- å®Œæ•´çš„ç‰Œå †é‡ç½®

## ç‰Œé¢æ ¼å¼è§„èŒƒ
Deckä½¿ç”¨ç»Ÿä¸€çš„2å­—ç¬¦ç‰Œé¢æ ¼å¼ï¼š
- **ç‚¹æ•°**: 2-9, T(10), J(11), Q(12), K(13), A(14)
- **èŠ±è‰²**: S(é»‘æ¡ƒ), H(çº¢å¿ƒ), D(æ–¹å—), C(æ¢…èŠ±)
- **ç¤ºä¾‹**: 'AH'(çº¢å¿ƒA), 'KS'(é»‘æ¡ƒK), 'TC'(æ¢…èŠ±10)

## æ ¸å¿ƒæ–¹æ³•

### åˆå§‹åŒ–å’Œé‡ç½®
```javascript
// åˆ›å»ºæ–°ç‰Œå †
const deck = new Deck();

// é‡ç½®åˆ°åˆå§‹çŠ¶æ€ï¼ˆ52å¼ ç‰Œï¼‰
deck.reset();
```

### æ´—ç‰Œæ“ä½œ
```javascript
// Fisher-Yatesç®—æ³•æ´—ç‰Œ
deck.shuffle();
// ç¡®ä¿éšæœºæ€§å’Œå…¬å¹³æ€§
```

### å‘ç‰Œæ“ä½œ
```javascript
// å‘ä¸€å¼ ç‰Œ
const card = deck.dealOne();
// è¿”å›: 'AH' | nullï¼ˆç‰Œå †ç©ºæ—¶ï¼‰

// å‘å¤šå¼ ç‰Œ
const cards = deck.dealMany(5);
// è¿”å›: ['AH', 'KS', 'QD', ...] ï¼ˆæœ€å¤šå‘å®Œæ‰€æœ‰å‰©ä½™ç‰Œï¼‰
```

### çŠ¶æ€æŸ¥è¯¢
```javascript
// è·å–å‰©ä½™ç‰Œæ•°
const remaining = deck.getRemainingCount();
// è¿”å›: 0-52

// æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„ç‰Œ
const hasEnough = deck.hasEnough(5);
// è¿”å›: boolean
```

## ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬æ¸¸æˆæµç¨‹
```javascript
import Deck from './Deck.js';

// å¼€å§‹æ–°ä¸€è½®
const deck = new Deck();
deck.shuffle();

// å‘æ‰‹ç‰Œï¼ˆæ¯äºº2å¼ ï¼‰
const players = ['alice', 'bob', 'charlie'];
const holeCards = {};

players.forEach(playerId => {
  holeCards[playerId] = deck.dealMany(2);
});

console.log('Aliceçš„æ‰‹ç‰Œ:', holeCards.alice); // ['AH', 'KD']

// å‘å…¬å…±ç‰Œ
const flop = deck.dealMany(3);      // ç¿»ç‰Œ
const turn = deck.dealOne();        // è½¬ç‰Œ
const river = deck.dealOne();       // æ²³ç‰Œ

console.log('å…¬å…±ç‰Œ:', [...flop, turn, river]); // ['QS', 'JC', 'TD', '9H', '8S']

// æ£€æŸ¥å‰©ä½™ç‰Œæ•°
console.log('å‰©ä½™ç‰Œæ•°:', deck.getRemainingCount()); // 52 - 2*3 - 5 = 41
```

### é”™è¯¯å¤„ç†
```javascript
// ç‰Œå †è€—å°½æ—¶çš„å¤„ç†
while (deck.getRemainingCount() > 0) {
  const card = deck.dealOne();
  console.log('å‘ç‰Œ:', card);
}

// ç‰Œå †ç©ºæ—¶è¿”å›null
const emptyCard = deck.dealOne();
console.log(emptyCard); // null

// æ‰¹é‡å‘ç‰Œä¸è¶³æ—¶è¿”å›å‰©ä½™æ‰€æœ‰ç‰Œ
deck.reset();
deck.dealMany(50); // å‘æ‰50å¼ 
const lastCards = deck.dealMany(5); // åªèƒ½å¾—åˆ°2å¼ 
console.log(lastCards.length); // 2
```

## æŠ€æœ¯ç‰¹ç‚¹
- **çº¯å‡½æ•°è®¾è®¡**: æ‰€æœ‰æ“ä½œéƒ½æ˜¯å¯é¢„æµ‹çš„
- **Fisher-Yatesç®—æ³•**: ç¡®ä¿æ´—ç‰Œçš„ç»Ÿè®¡å­¦éšæœºæ€§
- **è¾¹ç•Œå®‰å…¨**: å¤„ç†ç‰Œå †è€—å°½ç­‰è¾¹ç•Œæƒ…å†µ
- **æ ¼å¼ç»Ÿä¸€**: ä¸HandEvaluatorç­‰æ¨¡å—å…¼å®¹çš„ç‰Œé¢æ ¼å¼
- **æ€§èƒ½ä¼˜åŒ–**: ç®€å•é«˜æ•ˆçš„æ•°ç»„æ“ä½œ

## ä¾èµ–å…³ç³»
- **ä¾èµ–**: æ— ï¼ˆçº¯JavaScriptå®ç°ï¼‰
- **è¢«ä¾èµ–**: Gameã€HandEvaluatorã€ReplayEngineç­‰éœ€è¦ç‰Œå †åŠŸèƒ½çš„æ¨¡å—

---

# HandEvaluator æ¨¡å—æ–‡æ¡£

## æ¦‚è¿°
HandEvaluatoræ¨¡å—è´Ÿè´£å¾·å·æ‰‘å…‹çš„ç‰ŒåŠ›è¯„ä¼°å’Œæ¯”è¾ƒï¼Œå°è£…ç¬¬ä¸‰æ–¹pokersolveråº“ï¼Œæä¾›ç»Ÿä¸€çš„ç‰ŒåŠ›åˆ†ææ¥å£ã€‚æ”¯æŒ7å¼ ç‰Œï¼ˆ2å¼ æ‰‹ç‰Œ+5å¼ å…¬å…±ç‰Œï¼‰çš„æœ€ä½³5å¼ ç»„åˆè¯„ä¼°ã€‚

## åŠŸèƒ½ç‰¹æ€§
- 7å¼ ç‰Œçš„æœ€ä½³5å¼ ç»„åˆè¯„ä¼°
- å¤šç©å®¶ç‰ŒåŠ›æ¯”è¾ƒå’Œè·èƒœè€…ç¡®å®š
- ç‰Œå‹ç­‰çº§å’Œä¸­æ–‡åç§°æ˜ å°„
- ç‰Œé¢æ ¼å¼è½¬æ¢å’Œå…¼å®¹æ€§å¤„ç†
- **é˜¶æ®µ1.5æ–°å¢**: æ‘Šç‰Œç»“æœè¯¦ç»†åˆ†æ
- å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæ£€æŸ¥

## ç‰ŒåŠ›è¯„ä¼°ç­‰çº§
HandEvaluatorä½¿ç”¨1-9çš„ç‰ŒåŠ›ç­‰çº§ç³»ç»Ÿï¼š
1. **é«˜ç‰Œ** (High Card)
2. **ä¸€å¯¹** (Pair)
3. **ä¸¤å¯¹** (Two Pair)
4. **ä¸‰æ¡** (Three of a Kind)
5. **é¡ºå­** (Straight)
6. **åŒèŠ±** (Flush)
7. **è‘«èŠ¦** (Full House)
8. **å››æ¡** (Four of a Kind)
9. **åŒèŠ±é¡º** (Straight Flush, åŒ…å«çš‡å®¶åŒèŠ±é¡º)

## æ ¸å¿ƒæ–¹æ³•

### åŸºç¡€è¯„ä¼°
```javascript
// è¯„ä¼°å•ä¸ªç©å®¶çš„ç‰ŒåŠ›
const result = handEvaluator.evaluate(holeCards, board);
// å‚æ•°: ['AH', 'KD'], ['QS', 'JC', 'TD', '9H', '8S']
// è¿”å›: { rank: 5, name: 'Straight', score: 5, cards: [...], description: '...' }
```

### ç‰ŒåŠ›æ¯”è¾ƒ
```javascript
// æ¯”è¾ƒä¸¤æ‰‹ç‰Œçš„å¤§å°
const comparison = handEvaluator.compare(hand1, hand2);
// è¿”å›: 1=hand1èƒœ, -1=hand2èƒœ, 0=å¹³å±€
```

### è·èƒœè€…ç¡®å®š
```javascript
// ä»å¤šä¸ªç©å®¶ä¸­æ‰¾å‡ºè·èƒœè€…
const winners = handEvaluator.findWinners(players, board);
// å‚æ•°: [{ id: 'alice', holeCards: ['AH', 'KD'] }, ...], ['QS', 'JC', 'TD', '9H', '8S']
// è¿”å›: ['alice'] æˆ– ['alice', 'bob'] (å¹³å±€æ—¶å¤šäºº)
```

### å·¥å…·æ–¹æ³•
```javascript
// è·å–ç‰Œå‹ä¸­æ–‡åç§°
const rankName = handEvaluator.getRankName(5);
// è¿”å›: 'é¡ºå­'
```

## é˜¶æ®µ1.5æ–°å¢åŠŸèƒ½

### æ‘Šç‰Œè¯¦ç»†åˆ†æ
```javascript
// æè¿°æœ€ä½³æ‰‹ç‰Œç»„åˆï¼ˆç”¨äºæ‘Šç‰Œå±•ç¤ºï¼‰
const detailed = handEvaluator.describeBestHand(holeCards, board);
// è¿”å›: {
//   score: 5,
//   rankName: 'é¡ºå­',
//   bestFive: ['AS', 'KH', 'QD', 'JC', 'TH'],
//   usedHole: ['AS', 'KH']  // ä½¿ç”¨çš„åº•ç‰Œ
// }
```

### åº•ç‰Œä½¿ç”¨åˆ†æ
describeBestHandæ–¹æ³•ä¼šè‡ªåŠ¨åˆ†ææœ€ä½³5å¼ ç‰Œç»„åˆä¸­ä½¿ç”¨äº†å“ªäº›åº•ç‰Œï¼š
- **å®Œå…¨ä½¿ç”¨**: ä¸¤å¼ åº•ç‰Œéƒ½åœ¨æœ€ä½³ç»„åˆä¸­
- **éƒ¨åˆ†ä½¿ç”¨**: ä»…ä¸€å¼ åº•ç‰Œåœ¨æœ€ä½³ç»„åˆä¸­
- **æœªä½¿ç”¨**: å®Œå…¨ä¾é å…¬å…±ç‰Œå½¢æˆæœ€ä½³ç»„åˆ

## æ ¼å¼è½¬æ¢æœºåˆ¶
HandEvaluatorè‡ªåŠ¨å¤„ç†ä¸¤ç§ç‰Œé¢æ ¼å¼ï¼š
- **é¡¹ç›®æ ¼å¼**: 'AH'ï¼ˆçº¢å¿ƒAï¼‰
- **pokersolveræ ¼å¼**: 'Ah'ï¼ˆçº¢å¿ƒaï¼‰

è½¬æ¢è§„åˆ™ï¼š
- ç‚¹æ•°ä¿æŒä¸å˜ï¼šA, K, Q, J, T, 9-2
- èŠ±è‰²è½¬æ¢ï¼šSâ†’s, Hâ†’h, Dâ†’d, Câ†’c

## ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ç‰ŒåŠ›è¯„ä¼°
```javascript
import HandEvaluator from './HandEvaluator.js';

const evaluator = new HandEvaluator();

// è¯„ä¼°ä¸€æ‰‹ç‰Œ
const holeCards = ['AH', 'AD'];
const board = ['KS', 'QH', 'JC', 'TD', '9S'];

const result = evaluator.evaluate(holeCards, board);
console.log(`ç‰Œå‹: ${result.name}`);           // "Straight"
console.log(`ç­‰çº§: ${result.rank}`);           // 5
console.log(`ä¸­æ–‡: ${evaluator.getRankName(result.rank)}`); // "é¡ºå­"
```

### å¤šäººå¯¹å†³
```javascript
const players = [
  { id: 'alice', holeCards: ['AH', 'AD'] },  // ä¸€å¯¹A
  { id: 'bob', holeCards: ['KH', 'KD'] },    // ä¸€å¯¹K
  { id: 'charlie', holeCards: ['QH', 'JH'] } // é«˜ç‰Œ
];

const board = ['TS', '9C', '8D', '7H', '2S'];
const winners = evaluator.findWinners(players, board);

console.log('è·èƒœè€…:', winners); // ['alice']
```

### é˜¶æ®µ1.5æ‘Šç‰Œå±•ç¤º
```javascript
// è·å–è·èƒœè€…è¯¦ç»†ä¿¡æ¯ç”¨äºç•Œé¢å±•ç¤º
const detailed = evaluator.describeBestHand(['AH', 'AD'], board);

console.log('è·èƒœç‰Œå‹:', detailed.rankName);        // "ä¸€å¯¹"
console.log('æœ€ä½³äº”å¼ :', detailed.bestFive);         // ['AH', 'AD', 'TS', '9C', '8D']
console.log('ä½¿ç”¨åº•ç‰Œ:', detailed.usedHole);         // ['AH', 'AD']

// UIæ˜¾ç¤ºé€»è¾‘
if (detailed.usedHole.length === 2) {
  console.log('ğŸƒ ä½¿ç”¨äº†ä¸¤å¼ åº•ç‰Œ');
} else if (detailed.usedHole.length === 1) {
  console.log('ğŸƒ ä½¿ç”¨äº†ä¸€å¼ åº•ç‰Œ');
} else {
  console.log('ğŸƒ å®Œå…¨ä¾é å…¬å…±ç‰Œ');
}
```

### é”™è¯¯å¤„ç†
```javascript
try {
  // ä¸è¶³5å¼ ç‰Œçš„é”™è¯¯å¤„ç†
  const result = evaluator.evaluate(['AH'], ['KS']);
} catch (error) {
  console.error(error.message); // "è‡³å°‘éœ€è¦5å¼ ç‰Œæ‰èƒ½è¯„ä¼°"
}

try {
  // æ— æ•ˆç‰Œé¢æ ¼å¼çš„é”™è¯¯å¤„ç†
  const result = evaluator.evaluate(['XX', 'YY'], ['KS', 'QH', 'JC']);
} catch (error) {
  console.error(error.message); // "æ— æ•ˆçš„ç‰Œé¢æ ¼å¼: XX"
}
```

## æŠ€æœ¯å®ç°ç‰¹ç‚¹

### ç¬¬ä¸‰æ–¹åº“é›†æˆ
- **pokersolver**: æˆç†Ÿçš„ç‰ŒåŠ›è¯„ä¼°åº“
- **æ ¼å¼è½¬æ¢**: é€æ˜çš„æ ¼å¼å…¼å®¹æ€§å¤„ç†
- **é”™è¯¯å°è£…**: å°†ç¬¬ä¸‰æ–¹åº“å¼‚å¸¸è½¬æ¢ä¸ºé¡¹ç›®æ ‡å‡†é”™è¯¯

### æ€§èƒ½ä¼˜åŒ–
- **ç¼“å­˜å‹å¥½**: è¯„ä¼°ç»“æœç»“æ„åŒ–ï¼Œä¾¿äºç¼“å­˜
- **æ‰¹é‡å¤„ç†**: findWinnersæ–¹æ³•é«˜æ•ˆå¤„ç†å¤šç©å®¶å¯¹å†³
- **æ ¼å¼è½¬æ¢**: æœ€å°åŒ–æ ¼å¼è½¬æ¢å¼€é”€

### æ‰©å±•æ€§è®¾è®¡
- **ä¸­æ–‡æ˜ å°„**: æ”¯æŒæœ¬åœ°åŒ–çš„ç‰Œå‹åç§°
- **è¯¦ç»†åˆ†æ**: é˜¶æ®µ1.5æ‰©å±•çš„æ‘Šç‰Œåˆ†æåŠŸèƒ½
- **æ¥å£ç¨³å®š**: å‘åå…¼å®¹çš„APIè®¾è®¡

## é”™è¯¯å¤„ç†ç­–ç•¥
HandEvaluatorå®ç°äº†å®Œå–„çš„é”™è¯¯å¤„ç†ï¼š
- **è¾“å…¥éªŒè¯**: ä¸¥æ ¼çš„å‚æ•°ç±»å‹å’Œæ•°é‡æ£€æŸ¥
- **æ ¼å¼éªŒè¯**: ç‰Œé¢æ ¼å¼æœ‰æ•ˆæ€§éªŒè¯
- **ç¬¬ä¸‰æ–¹å¼‚å¸¸**: pokersolverå¼‚å¸¸çš„æ•è·å’Œè½¬æ¢
- **è¾¹ç•Œæƒ…å†µ**: ç‰Œæ•°ä¸è¶³ç­‰è¾¹ç•Œæƒ…å†µçš„ä¼˜é›…å¤„ç†

## ä¾èµ–å…³ç³»
- **ä¾èµ–**: pokersolverï¼ˆç¬¬ä¸‰æ–¹ç‰ŒåŠ›è¯„ä¼°åº“ï¼‰
- **è¢«ä¾èµ–**: Gameã€PotManagerã€TournamentManagerç­‰éœ€è¦ç‰ŒåŠ›æ¯”è¾ƒçš„æ¨¡å—

## é˜¶æ®µ1.5é›†æˆè¦ç‚¹
HandEvaluatoråœ¨é˜¶æ®µ1.5ä¸­æ–°å¢äº†æ‘Šç‰Œè¯¦ç»†å±•ç¤ºåŠŸèƒ½ï¼š
- **Gameé›†æˆ**: Game.jsåœ¨æ‘Šç‰Œæ—¶è°ƒç”¨describeBestHandæ–¹æ³•
- **UIå±•ç¤º**: å®¢æˆ·ç«¯ä½¿ç”¨è¯¦ç»†ä¿¡æ¯å±•ç¤ºè·èƒœè€…ç‰Œå‹
- **æ•°æ®å®Œæ•´**: æä¾›ç‰Œå‹åç§°ã€æœ€ä½³ç»„åˆã€åº•ç‰Œä½¿ç”¨ç­‰å®Œæ•´ä¿¡æ¯

## æŠ€æœ¯ç‰¹ç‚¹æ€»ç»“
- **ä¸“ä¸šæ€§**: åŸºäºæˆç†Ÿçš„pokersolveråº“ç¡®ä¿ç®—æ³•å‡†ç¡®æ€§
- **æ˜“ç”¨æ€§**: ç®€æ´çš„APIè®¾è®¡å’Œå®Œå–„çš„é”™è¯¯æç¤º
- **å…¼å®¹æ€§**: æ— ç¼çš„æ ¼å¼è½¬æ¢å’Œå‘åå…¼å®¹
- **æ‰©å±•æ€§**: ä¾¿äºæ·»åŠ æ–°çš„åˆ†æåŠŸèƒ½å’Œæœ¬åœ°åŒ–æ”¯æŒ
- **å¯é æ€§**: å…¨é¢çš„é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæƒ…å†µè¦†ç›–

Coreæ¨¡å—ä¸ºå¾·å·æ‰‘å…‹æ¸¸æˆæä¾›äº†åšå®çš„åŸºç¡€åŠŸèƒ½ï¼ŒDeckç¡®ä¿äº†å…¬å¹³çš„ç‰Œå †ç®¡ç†ï¼ŒHandEvaluatoræä¾›äº†å‡†ç¡®çš„ç‰ŒåŠ›è¯„ä¼°ï¼Œä¸¤è€…å…±åŒæ„æˆäº†æ¸¸æˆç³»ç»Ÿçš„æ ¸å¿ƒåŸºçŸ³ã€‚